# Cyb3rhq - Filebeat configuration file
output.elasticsearch.hosts:
        - 127.0.0.1:9200

output.elasticsearch:
  protocol: https
  username: ${username}
  password: ${password}
  ssl.certificate_authorities:
    - /etc/filebeat/certs/root-ca.pem
  ssl.certificate: "/etc/filebeat/certs/cyb3rhq-server.pem"
  ssl.key: "/etc/filebeat/certs/cyb3rhq-server-key.pem"
  index: "cyb3rhq-alerts-5.x-%{+yyyy.MM.dd}"

setup.kibana.host: "https://127.0.0.1:443"
setup.kibana.protocol: "https"
setup.kibana.ssl.enabled: true
setup.kibana.ssl.certificate_authorities: ["/etc/filebeat/certs/root-ca.pem"]
setup.kibana.ssl.certificate: "/etc/cyb3rhq-dashboard/certs/cyb3rhq-dashboard.pem"
setup.kibana.ssl.key: "/etc/cyb3rhq-dashboard/certs/cyb3rhq-dashboard-key.pem"

setup.template.name: 'cyb3rhq-5'
setup.template.pattern: 'cyb3rhq-alerts-5.x-*'
setup.template.json.enabled: true
setup.template.json.path: '/etc/filebeat/cyb3rhq-template.json'
setup.template.json.name: 'cyb3rhq-5'
setup.template.settings:
  index.number_of_shards: 1
  index.number_of_replicas: 0
setup.template.overwrite: true
setup.ilm.overwrite: true
setup.ilm.enabled: false

logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644

logging.metrics.enabled: false

seccomp:
  default_action: allow
  syscalls:
  - action: allow
    names:
    - rseq

filebeat.inputs:
  - type: log
    paths:
      - /var/ossec/logs/alerts/alerts-ECS.json
    json.overwrite_keys: true
    json.keys_under_root: true
    json.expand_keys: true
    publisher_pipeline.disable_host: true

processors:
  - drop_fields:
      when:
        equals:
          log.file.path: "/var/ossec/logs/alerts/alerts-ECS.json"
      fields: ["log.offset", "log.file"]

  - drop_fields:
      fields: ["agent.ephemeral_id", "agent.hostname", "agent.version", "input", "ecs"]
  - drop_fields:
      when:
        not:
          equals:
            agent.type: cyb3rhq-agent
      fields: ["agent.type"]
