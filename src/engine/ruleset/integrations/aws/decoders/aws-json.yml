name: decoder/aws-json/0

metadata:
  title: Cyb3rhq wodle AWS integration JSON Decoder
  description: Partial JSON decoder for AWS wodle events
  module: AWS
  compatibility: >
    This decoder has been tested on Cyb3rhq version 4.4
  references:
    - https://documentation.wazuh.com/current/user-manual/reference/ossec-conf/wodle-s3.html
  versions:
    - "4.4"
  author:
    name: Cyb3rhq, Inc.
    date: 2023/05/04

parents:
  - decoder/integrations/0

# TODO: wodle output should be fixed
# Wodle output              -> "location": "Cyb3rhq-AWS"
# How it should be received -> "location": "[NNN] (MMMMM) any->Cyb3rhq-AWS"
#                                                             <-origin->
check:
  - event.original: +starts_with/{
  - cyb3rhq.location: +string_equal/Cyb3rhq-AWS

parse:
  logpar:
    - event.original: <json_event/json>

normalize:
 - map:
    - cyb3rhq.decoders: +array_append/aws-json

 - check:
    - json_event.integration: aws
   map:
    - event.module: aws
